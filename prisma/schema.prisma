generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model categories {
  id          Int        @id @default(autoincrement())
  nombre      String     @db.VarChar(50)
  descripcion String?
  products    products[]
}

model order_items {
  id              Int       @id @default(autoincrement())
  order_id        Int?
  product_id      Int?
  cantidad        Decimal   @db.Decimal(10, 2)
  precio_unitario Decimal   @db.Decimal(10, 2)
  orders          orders?   @relation(fields: [order_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  products        products? @relation(fields: [product_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model orders {
  id              Int           @id @default(autoincrement())
  user_id         Int?
  total           Decimal       @db.Decimal(10, 2)
  estado          String?       @default("pendiente") @db.VarChar(20)
  tipo_entrega    String?       @db.VarChar(20)
  notas           String?
  created_at      DateTime?     @default(now()) @db.Timestamp(6)
  metodo_pago     String?
  comprobante_url String?
  order_items     order_items[]
  users           users?        @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model products {
  id              Int               @id @default(autoincrement())
  category_id     Int?
  nombre          String            @db.VarChar(100)
  descripcion     String?
  precio          Decimal           @db.Decimal(10, 2)
  stock           Decimal?          @default(0) @db.Decimal(10, 2)
  imagen_url      String?
  activo          Boolean?          @default(true)
  created_at      DateTime?         @default(now()) @db.Timestamp(6)
  updated_at      DateTime?         @default(now()) @db.Timestamp(6)
  order_items     order_items[]
  categories      categories?       @relation(fields: [category_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  stock_movements stock_movements[]
}

model settings {
  id                      Int      @id @default(autoincrement())
  nombre_negocio          String?  @default("Mi Poller√≠a") @db.VarChar(100)
  costo_delivery          Decimal? @default(0) @db.Decimal(10, 2)
  whatsapp_notificaciones String?  @db.VarChar(20)
  esta_abierto            Boolean? @default(true)
  direccion_local         String?
  mensaje_alerta          String?
}

model stock_movements {
  id         Int       @id @default(autoincrement())
  product_id Int?
  cantidad   Decimal   @db.Decimal(10, 2)
  tipo       String?   @db.VarChar(20)
  motivo     String?
  created_at DateTime? @default(now()) @db.Timestamp(6)
  products   products? @relation(fields: [product_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model user_tokens {
  id         Int       @id @default(autoincrement())
  user_id    Int
  token_hash String    @unique
  expires_at DateTime  @db.Timestamptz(6)
  used_at    DateTime? @db.Timestamptz(6)
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_user")

  @@index([user_id], map: "idx_user_tokens_user_id")
}

model users {
  id          Int           @id @default(autoincrement())
  nombre      String        @db.VarChar(100)
  email       String        @unique @db.VarChar(100)
  password    String        @db.VarChar(255)
  rol         String?       @default("cliente") @db.VarChar(20)
  telefono    String?       @db.VarChar(20)
  direccion   String?
  created_at  DateTime?     @default(now()) @db.Timestamp(6)
  orders      orders[]
  user_tokens user_tokens[]
}
